# 假设检验

- [假设检验](#假设检验)
  - [1. 简介](#1-简介)
  - [2. 检验步骤](#2-检验步骤)
    - [(1) 提出假设](#1-提出假设)
    - [(2) 显著性水平](#2-显著性水平)
    - [(3) 接受域和拒绝域](#3-接受域和拒绝域)
    - [(4) 计算统计量](#4-计算统计量)
    - [(5) 下结论](#5-下结论)
  - [3. 错误类型](#3-错误类型)
  - [4. 假设检验总结](#4-假设检验总结)
  - [5. 示例](#5-示例)

2024-05-08 ⭐
@author Jiawei Mao
***

## 1. 简介

假设检验的核心是：针对**总体的一个参数**（parameter）提出假设，然后根据样本信息来拒绝或接受这个假设。

主要内容：

- 对假设检验的每个步骤进行详解；
- 步骤总结；
- 实例展示。

## 2. 检验步骤

### (1) 提出假设

首先提出对 **总体参数 (parameter)** 的假设。一定是对总体参数的假设，而非样本统计量。

下面以平均值为例介绍如何进行假设检验。

假设声明包括两个对立假设：

- 原假设（null hypothesis）$H_0$：原假设声明通常包含等号，如 $\mu=\mu_0$, $\mu\ge \mu_0$, $\mu\le\mu_0$；
- 备择假设（alternative hypothesis, $H_a$）：$H_0$ 的对立情况，备择假设的声明不包含等号，如 $\mu\ne\mu_0$, $\mu< \mu_0$, $\mu>\mu_0$；

### (2) 显著性水平

当 $H_0$ 为 true，拒绝 $H_0$ 的最大概率（$\alpha$），又称为显著性水平（significance level）。$\alpha$ 通常取 0.05 或 0.01。

以橙子为例，假设山上橙子的平均甜度为 8.5：

$$
H_0: \mu=8.5\\
H_a: \mu\ne 8.5
$$

采了几百个橙子作为样本，测它们的甜度，平均为 $\overline{X}=2.5$.

显然，从总体 $\mu=8.5$ 的总体抽样，虽然样本均值可能为 $\overline{X}=2.5$，但是概率很小：

- 这种小概率事件很难发生，因此我们拒绝接受 $H_0=8.5$ 的假设；
- 拒绝的决策可能是错的，错误概率就是这个小概率事件发生的概率，最多就是 $\alpha$ 值；
- $H_0$ 为 true 时拒绝 $H_0$ 的错误称为 **I 类错误（Type I error）**，犯 I 类错误的概率最大为 $\alpha$。

### (3) 接受域和拒绝域

拒绝域（critical region）：拒绝 $H_0$ 的区域。拒绝 $H_0$ 同时也是接受 $H_a$ 的区域。

### (4) 计算统计量

取样，计算统计量，如 $\overline{X}$，作 z-转换：

$$
z=\frac{\overline{X}-\mu_0}{\sigma/\sqrt{n}}
$$

### (5) 下结论

如果 $z$ 落在接受域（region of acceptance），就接受 $H_0$。

如果 $z$ 落在拒绝域（critical region），就拒绝 $H_0$，接受 $H_a$。

## 3. 错误类型

不管下哪个结论，都可能犯错：

- $H_0$ 为 true 拒绝 $H_0$，称为 Type I error，犯这类错误的最大概率为 $\alpha$；
- $H_0$ 为 false 接受 $H_0$，称为 Type II error，犯这类错误的最大概率为 $\beta$。

|结论|$H_0$ 为 true|$H_0$ 为 false|
|---|---|---|
|接受|✔️|Type II error|
|拒绝|Type I error|✔️|

所以，接受 $H_0$ 时，只可能犯 Type II error；拒绝 $H_0$ 时，只可能犯 Type I error。

我们一般将 Type I error 控制得很小（如 1% 或 5%），那么如何控制 Type II error？

因为：

$$
z=\frac{\overline{X}-\mu_0}{\sigma/\sqrt{n}}
$$

所以：

$$
\overline{X}=\mu_0+z\sigma/\sqrt{n}
$$

$H_0$ 为 false 接受 $H_0$ 为 Type II error，如下图所示：

<img src="./images/5bd20d03240611540492547.png" alt="img" style="zoom: 50%;" />

在犯 Type II error 时，右边才是真实的分布。在真实分布接受 $H_0$ 临界值的左侧，都是犯 Type II error。

上图的那根分割线，对应 $z$ 值，是通过左侧的分布定的；在线的左边接受 $H_0$，但是犯 Type II error 时，左侧分布是错的，真实分布在右侧，此时在真实分布中，$z$ 的左侧接受 $H_0$，意味着犯 Type II error。上图中：

- 红色面积为 $\alpha$；
- 绿色面积为 $\beta$.

影响 $\beta$ 的因素：

1. 假设的 $\mu_0$ 与真实 $\mu$ 的距离：$\mu_0$ 与 $\mu$ 越接近，$\beta$ 越大；
   - 简而言之，$H_0$ 为 false，但假的和真的越接近，越容易把 $H_0$ 当真的，假的当真，就是 Type II error
2. 降低 $\alpha$，$\beta$ 随之增大；

这两个因素我们都没办法控制，但是还有第三个因素，是可以认为控制的：

3. 当上图的两个分布变窄，即方差减小，$\beta$ 也就较少了。而我们知道

$$
\sigma^2_{\overline{X}}=\frac{\sigma^2_X}{n}
$$

总体 $\sigma_X^2$ 不变（或者说没法控制），所以增加样本量，就可以有效降低 Type II error，$\beta$ 减小。

定义：

$$
\text{power of test} = 1-\beta
$$

## 4. 假设检验总结

1. 声明假设 $H_0$ 和 $H_a$；
2. Assumption；
   i. $\overline{X}$ 为 normal distribution
   ii. 样本：random
   iii. $\sigma^2$ 已知：因为这里用最简单的 z-test 介绍假设检验
3. 指定 $\alpha$；
4. 计算拒绝域；
5. 抽样
   i. 计算统计量，如 $\overline{X}$;
   ii. 计算 $z$
6. 下结论

## 5. 示例

**例 1.** 科学家声称他养殖的昆虫，每次产卵 40 个。已知 $\sigma=4$。随机抽样 16 个，平均产卵 $\overline{X}=41.5$。那么科学家的声明对不对。

按照假设检验步骤：

1. 声明假设

$$
H_0: \mu=40\\
H_a: \mu \ne 40
$$

2. Assumption
   1. 昆虫每次产卵的个数为 normal distribution；
   2. 随机抽样；
   3. $\sigma=4$。
3. $\alpha=0.05$；
4. 这属于双边检验，查表得 $z$ 在 -1.96 到 1.96；
5. 计算样本的 z

$$
z=\frac{\overline{X}-\mu_0}{\sigma/\sqrt{n}}=1.5
$$

6. 下结论

$z$ 落在接受域内，所以接受 $H_0$。接受 $H_0$ 可能会犯 Type II error。

**例 2.** 老鼠跑出迷宫，最多需要 3 分钟。随机找 25 只老鼠，平均 3.5 分钟出来。假设 $\sigma=0.5$ 分钟。

1. 声明假设

$$
H_0: \mu = 3\\
H_a: \mu > 3
$$

2. Assumption
   1. 老鼠跑出迷宫的时间服从正态分布；
   2. 25 只老鼠是随机抽取的有代表性的老鼠；
   3. $\sigma=0.5$
3. $\alpha=0.05$;
4. 右边检验，计算临界值，查表得 $z=1.645$；
5. 计算样本 $z$

$$
z=\frac{\overline{X}-\mu_0}{\sigma/\sqrt{n}}=5
$$

6. 下结论

样本 $z$ 落在拒绝域，所以拒绝 $H_0$，接受 $H_a$，认为老鼠跑迷宫的时间大于 3 分钟，最多有 5% 的概率犯 Type I error。
