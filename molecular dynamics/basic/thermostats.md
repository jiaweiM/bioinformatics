# 恒温方法

- [恒温方法](#恒温方法)
  - [简介](#简介)
  - [速度调节](#速度调节)
  - [Berendsen thermostat](#berendsen-thermostat)
  - [Andersen thermostat](#andersen-thermostat)
  - [Nosè-Hoover thermostat](#nosè-hoover-thermostat)
  - [Bussi-Donadio-Parrinello thermostat](#bussi-donadio-parrinello-thermostat)
  - [参考](#参考)

Last updated: 2022-11-21, 16:14
****

## 简介

分子动力学模拟可以在不同条件或系综下进行。通过恒温器（thermostat）算法可以模拟恒温系统。

恒温系综称为正则系综（canonical ensemble），下面详细介绍恒温算法。

## 速度调节

在统计力学中，无约束系统的温度 $T$ 与动能 $K$ 的时间均值相关。对包含 $N$ 个原子的系统：

$$\langle K \rangle=\frac{3}{2}Nk_BT$$

其中 $k_B$ 是玻尔兹曼常数。为了保持系统的温度，需要确保动能是恒定的，当然瞬时动能 $K$ 允许波动。动能公式：

$$K=\frac{1}{2}\sum_i m_iv_i^2$$

调节系统温度使其保持恒定的一种可能方法是调整速度。换句话说，通过调整速度使系统的平均动能在一定时间内保持恒定，可以实现系统恒温。

将速度乘以缩放因子 $\lambda$：

$$v_i^{new}=v_i^{old}\cdot \lambda$$

在每个时间步，如果检测系统温度过高（原子移动太快），就将所有原子速度乘以缩放因子 $\lambda < 1$。相反，如果系统温度偏低（原子移动太慢），就乘以一个大于 1 的缩放因子 $\lambda > 1$。缩放因子的实际值取决于期望温度 $T_{des}$ 和在特定时间步系统实际温度 $T(t)$:

$$\lambda = \sqrt{\frac{T_{des}}{T(t)}}$$

施加恒温方法后，系统在模拟的每个时间步检查系统的温度，并根据期望温度对系统原子的速度进行调整。

这是速度缩放方法背后的基本思想，也是最基本的恒温算法。

> **NOTE:** 这种通过缩放速度的方法，不能再现实际的正则系综。如果在每个时间步都对速度进行了精确缩放，动能就不会有波动了，这与实际情况不符。所以在实际 MD 实验中，基本不会使用简单的速度缩放算法。

## Berendsen thermostat

Berendsen 恒温算法涉及了以与外部热浴耦合的系统，热浴温度与期望温度一致。

可以把外部浴池想象成热能的来源，根据系统所需温度提供或移除热量。此时，可以假设温度的变化与浴池 $T_{bath}$ 和系统之间的温度差成正比：

$$\frac{\partial T(t)}{\partial t}=\frac{1}{\tau} (T_{bath}-T(t))$$

参数 $\tau$ 表示浴池和系统之间的耦合强度。

Berendsen 恒温器的缩放因子公式：

$$\lambda = \sqrt{1+\frac{\delta t}{\tau}(\frac{T_{bath}}{T(t)}-1)}$$

其中 $\delta t$ 为时间步。

这种方法的主要优点是，我们可以根据需要选择耦合值。耦合值 $\tau$ 较大时，$\lambda=1$，不对速度进行修改，换句话说，热浴和系统之间没有耦合；耦合值 $\tau$ 较小则对应强耦合、快速平衡，以及过低的温度波动。

所以 $\tau$ 值的选择要谨慎，对 $1 fs$ 的典型时间步，通常取 $\tau=1ps$。即系统与恒温器每 1ps 耦合一次。

> **NOTE:** Berendsen 算法不能保证正则系统的正确采样。因此，应该避免在生产运行时候使用。不过，在 MD 模拟的能量最小化步骤后放松系统非常有用，它能够快速达到所需温度。

## Andersen thermostat

Andersen 提供了一种随机碰撞方法。Andersen 恒温算法对作用于系统粒子的随机碰撞进行模拟，最终改变系统温度 $T$。我们依然可以将其想象成一个与系统接触的热浴，释放出随机粒子与系统中的原子碰撞。热浴和系统之间的耦合强度由**碰撞频率** $\nu$ 指定。

从实现的角度来看，模拟碰撞的方法是随机选择原子，并在所需的温度 $T$ 下根据麦克斯韦-玻尔兹曼分布重新分配速度。

同一原子的重新分配速度的时间间隔 $t$ 由泊松分布给出：

$$P(t)=\nu e^{-\nu t}$$

碰撞频率的选择很重要，$\nu$ 值小会导致温度控制差，也不能确保系统为正则系综。想法，碰撞频率过大，系统收到的干扰也大。

总结一下，Andersen 算法可以分为三步：

1. 从初始构型开始，对运行方程进行积分；
2. 随机选择原子，与热浴中的离子发生碰撞；
3. 被选择的粒子根据麦克斯韦-玻尔兹曼芬恩不重新分配新的速度，其余粒子不受影响。

该算法可以根据需要重复多个时间步。

## Nosè-Hoover thermostat

Nosè-Hoover 衡算算法属于一类称为扩展系统的方法，由 Nosè 提出，并由 Hoover 进一步开发。

与前一个方法的主要区别在于，该方法通过在哈密顿算符中包含额外的自由度 $s$ 将热浴直接纳入系统。热源有指定的质量 $Q$、势能和动能。

其基本思想是，$Q$ 表示系统和热浴之间的耦合，质量 $Q$ 大对应低耦合，反之亦然。根据需要调节，以减缓或加速粒子，直到达到所需温度。

$Q$ 值选择需谨慎，$Q$ 值大导致没有热量传递，$Q$ 值小导致高频率热量传递，造成不必要的温度震荡。在实践中，使用多个恒温器耦合到系统的特定部分，可以促进热量在系统中的平等重新分配。

> **NOTE:** Nosè-Hoover 是再现正则系统的合适选项。它目前是经典分子动力学生产运行中使用最多的恒温器之一。

## Bussi-Donadio-Parrinello thermostat

Bussi-Donadio-Parrinello 恒温器，也称为随机速度缩放，是对 Berendsen 恒温器的扩展。它允许对正则系综进行采样。

其主要特点是，它不强迫动能与期望值完全相同，而是从动能的正则平衡分布中随机选择动能进行缩放。

> **NOTE:** 这种 thermostat 也广泛用于 MD 的生产运行，在 GROMACS 中称为 `V-rescale`。

## 参考

- https://www.compchems.com/thermostats-in-molecular-dynamics/
