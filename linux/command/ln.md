# ln

- [ln](#ln)
  - [简介](#简介)
    - [硬链接](#硬链接)
    - [符号链接](#符号链接)
  - [语法](#语法)
  - [示例](#示例)

Last updated: 2023-04-12, 14:38
*****

## 简介

`ln` (link) 用于为某个文件在另外一个位置建立同步的链接。

Linux系统中的链接文件有两种形式，一种是硬链接（hard link），另一种是软链接（symbolic link）。

- 软连接相当于Windows系统中的快捷方式文件，原始文件被移动或删除后，软连接文件也将无法使用；
- 硬链接复制了文件的 inode 属性块，因此把原始文件移动或删除后，硬链接文件依然可以使用。

### 硬链接

与现代的符号链接相比，硬链接是最初 Unix 创建链接的方式。每个文件默认包含一个硬链接，给与文件名字。每创建一个硬链接，就为一个文件创建了一个额外的目录项。硬链接有两个局限性：

- 硬链接不能关联它所在文件系统之外的文件，即硬链接不能关联与链接不在一个硬盘分区上的文件。
- 硬链接不能关联目录

硬链接和文件本身没有什么区别。当一个硬链接被删除时，这个链接被删除，但是文件本身的内容依然存在（所以它所在的磁盘空间不会被重新分配），直到所有关联这个文件的链接都删除。

可以将文件想象成由两部分组成：

- 包含文件内容的数据部分
- 包含文件名的名称部分

当创建硬链接时，实际上为文件创建了额外的名称部分，并且这些名字关联到相同的数据部分。系统会分配一连串的磁盘块给索引节点，然后索引节点与文件名部分关联。因此，每个硬链接都关联到一个具体的包含文件内容的索引节点。

### 符号链接

符号链接是为了克服硬链接的局限性而创造。符号链接通过创建一个特殊类型的文件，这个文件包含一个关联文件或目录的文本指针。在这方面，它们和Windows的快捷方式差不多，当然，符号链接早于 Windows 的快捷方式很多年。

一个符号链接指向一个文件，而且这个符号链接本身与其它的符号链接几乎没有区别。例如，如果你往一个符号链接里写入东西，那么相关联的文件也被写入。然而，当你删除符号链接时，只有这个链接被删除，而不删除文件自身。如果先于符号链接删除文件，这个链接仍然存在，但是不指向任何东西。在这种情况下，这个链接被称为**坏链接**。在许多实现中，ls 命令会以不同的颜色展示坏链接，比如红色。

创建符号链接的方式和硬链接类似：

```bash
ln -s fun fun-sym
```

就多了个 `-s`。

`ln` 可用于创建硬链接和符号链接。

- 创建硬链接

```bash
ln file link
```

- 创建符号链接

```bash
ln -s item link
```

`item` 可以是一个文件或目录。

## 语法

```sh
ln [参数] 源文件 目标文件
```

|参数|说明|
|---|---|
|`-b`|为每个已存在的目标文件创建备份文件|
|`-d`|此选项允许“root”用户建立目录的硬链接|
|`-f`|强制创建链接，即使目标文件已经存在|
|`-n`|把指向目录的符号链接视为一个普通文件|
|`-i`|交互模式，若目标文件已经存在，则提示用户确认进行覆盖|
|`-s`|对源文件创建符号链接，而非硬链接|
|`-v`|详细信息模式，输出指令的详细执行过程|

## 示例

- 为指定文件创建快捷方式（默认硬链接）

```sh
ln anaconda-ks.cfg ana.cfg
```

- 为指定文件创建软链接

```sh
ln -s initial-setup-ks.cfg ini.cfg
```

- 判断硬链接指向文件

要判断多个硬链接是否指向相同数据部分，可以使用 `ls -i` 选项，显示 inode 编号：

```bash
$ ls -li
total 16
56742 drwxr-xr-x 2 mjw mjw 4096 Apr 12 14:50 dir1
56747 drwxr-xr-x 2 mjw mjw 4096 Apr 12 14:50 dir2
56754 -rw-r--r-- 4 mjw mjw 1414 Apr 12 14:43 fun
56754 -rw-r--r-- 4 mjw mjw 1414 Apr 12 14:43 fun-hard
```

第一个字段就是 inode 值，可以看到 fun 和 fun-hard 的 inode 值向量，表示两者是同一个文件。

- 相对路径创建符号链接

```bash
$ pwd
/home/mjw/playground
$ ls -l
total 16
drwxr-xr-x 2 mjw mjw 4096 Apr 12 15:00 dir1
drwxr-xr-x 2 mjw mjw 4096 Apr 12 15:00 dir2
-rw-r--r-- 4 mjw mjw 1414 Apr 12 14:43 fun
-rw-r--r-- 4 mjw mjw 1414 Apr 12 14:43 fun-hard
lrwxrwxrwx 1 mjw mjw    3 Apr 12 14:59 fun-sym -> fun
$ ln -s ../fun dir1/fun-sym
$ ln -s ../fun dir2/fun-sym
$ ls -l dir1
total 4
-rw-r--r-- 4 mjw mjw 1414 Apr 12 14:43 fun-hard
lrwxrwxrwx 1 mjw mjw    6 Apr 12 15:00 fun-sym -> ../fun
```

在创建符号链接时，相当于用文本描述目标文件**相对于符号链接**的位置。

在创建符号链接时，可以使用相对路径和绝对路径。大多时候，使用相对路径更合适。
